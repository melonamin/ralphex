<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ralphex Dashboard - {{.PlanName}}</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <aside class="session-sidebar" id="session-sidebar">
        <div class="sidebar-header">
            <span class="sidebar-title">Sessions</span>
            <div class="sidebar-controls">
                <button class="view-toggle" id="view-toggle" title="Sorted by time (click to group by project)">
                    <span class="view-icon">T</span>
                </button>
                <button class="sidebar-toggle" id="sidebar-toggle" title="Toggle sidebar (S)">◀</button>
            </div>
        </div>
        <div class="sidebar-collapsed-label">Sessions</div>
        <div class="session-list" id="session-list">
            <div class="session-loading">Loading sessions...</div>
        </div>
    </aside>

    <div class="main-wrapper" id="main-wrapper">
        <header>
            <div class="header-top">
                <h1>Ralphex Dashboard</h1>
                <div class="status-area">
                    <span class="elapsed-time" id="elapsed-time"></span>
                    <span class="diff-stats" id="diff-stats"></span>
                    <span class="status-badge" id="status-badge"></span>
                    <button class="new-plan-btn" id="new-plan-btn" title="Create new plan (N)">+ New Plan</button>
                    <button class="export-btn" id="export-btn" title="Export session as HTML">Export</button>
                    <button class="help-btn" id="help-btn" title="Keyboard shortcuts (?)" aria-label="Show keyboard shortcuts">?</button>
                </div>
            </div>
            <div class="info">
                <div class="project-wrap is-hidden" id="project-wrap">
                    <span class="project" id="project-path" title="Project"></span>
                    <button class="project-copy" id="project-copy" title="Copy full path" aria-label="Copy project path">Copy</button>
                </div>
                <span class="plan" id="plan-name" title="Plan">{{.PlanName}}</span>
                <span class="branch" id="branch-name" title="Branch">{{.Branch}}</span>
                <button class="plan-resume-btn" id="plan-resume-btn" title="Resume plan session" aria-disabled="true">Resume plan</button>
            </div>
        </header>

        <nav class="phase-nav">
            <button class="phase-tab active" data-phase="all">All</button>
            <button class="phase-tab" data-phase="task">Implementation</button>
            <button class="phase-tab" data-phase="review">Claude Review</button>
            <button class="phase-tab" data-phase="codex">Codex Review</button>
            <span class="nav-separator"></span>
            <button class="collapse-btn" id="expand-all" title="Expand all sections">Expand All</button>
            <button class="collapse-btn" id="collapse-all" title="Collapse all sections">Collapse All</button>
        </nav>

        <div class="search-bar">
            <input type="text" id="search" placeholder="Search... (press / to focus)" autocomplete="off">
        </div>

        <div class="main-container">
            <aside class="plan-panel" id="plan-panel">
                <div class="plan-panel-header">
                    <span class="plan-panel-title">Plan</span>
                    <button class="plan-toggle" id="plan-toggle" title="Toggle plan panel (P)">▶</button>
                </div>
                <div class="plan-collapsed-label">Plan</div>
                <div class="plan-content" id="plan-content">
                    <div class="plan-loading">Loading plan...</div>
                </div>
            </aside>

            <main class="output-panel">
                <div id="output"></div>
            </main>
        </div>

        <div class="scroll-indicator" id="scroll-indicator">
            <button id="scroll-to-bottom">Scroll to bottom</button>
        </div>
    </div>

    <div class="help-overlay" id="help-overlay">
        <div class="help-modal">
            <div class="help-header">
                <span class="help-title">Keyboard Shortcuts</span>
                <button class="help-close" id="help-close">×</button>
            </div>
            <div class="help-content">
                <div class="help-section">
                    <div class="help-section-title">Navigation</div>
                    <div class="help-row"><kbd>j</kbd> <span>Next section</span></div>
                    <div class="help-row"><kbd>k</kbd> <span>Previous section</span></div>
                    <div class="help-row"><kbd>Space</kbd> <span>Toggle focused section</span></div>
                    <div class="help-row"><kbd>Enter</kbd> <span>Toggle focused section</span></div>
                </div>
                <div class="help-section">
                    <div class="help-section-title">Sections</div>
                    <div class="help-row"><kbd>e</kbd> <span>Expand all sections</span></div>
                    <div class="help-row"><kbd>c</kbd> <span>Collapse all sections</span></div>
                </div>
                <div class="help-section">
                    <div class="help-section-title">Panels</div>
                    <div class="help-row"><kbd>p</kbd> <span>Toggle plan panel</span></div>
                    <div class="help-row"><kbd>s</kbd> <span>Toggle sessions sidebar</span></div>
                    <div class="help-row"><kbd>t</kbd> <span>Sessions: sort by time</span></div>
                    <div class="help-row"><kbd>g</kbd> <span>Sessions: group by project</span></div>
                </div>
                <div class="help-section">
                    <div class="help-section-title">Search</div>
                    <div class="help-row"><kbd>/</kbd> <span>Focus search</span></div>
                    <div class="help-row"><kbd>Esc</kbd> <span>Clear search / close help</span></div>
                </div>
                <div class="help-section">
                    <div class="help-section-title">Other</div>
                    <div class="help-row"><kbd>n</kbd> <span>New plan</span></div>
                    <div class="help-row"><kbd>?</kbd> <span>Show this help</span></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="new-plan-overlay">
        <div class="modal new-plan-modal">
            <div class="modal-header">
                <span class="modal-title">Create New Plan</span>
                <button class="modal-close" id="new-plan-close">×</button>
            </div>
            <div class="modal-content">
                <div id="resumable-sessions" class="resumable-sessions" style="display: none;"></div>
                <div class="form-group">
                    <label for="plan-dir">Project Directory</label>
                    <div class="dir-input-group">
                        <select id="plan-dir-select" class="dir-select">
                            <option value="">Select recent directory...</option>
                        </select>
                        <input type="text" id="plan-dir" class="dir-input" placeholder="/path/to/project" autocomplete="off">
                    </div>
                    <div class="form-hint">Select from recent or enter a new path</div>
                </div>
                <div class="form-group">
                    <label for="plan-description">Plan Description</label>
                    <textarea id="plan-description" class="plan-textarea" placeholder="Describe what you want to build..." rows="3"></textarea>
                    <div class="form-hint">Brief description of the feature or task</div>
                </div>
                <div class="form-actions">
                    <button class="btn btn-secondary" id="new-plan-cancel">Cancel</button>
                    <button class="btn btn-primary" id="new-plan-start">Start New</button>
                </div>
                <div class="form-error" id="new-plan-error"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="question-overlay">
        <div class="modal question-modal">
            <div class="modal-header">
                <span class="modal-title">Claude needs your input</span>
            </div>
            <div class="modal-content">
                <div class="question-text" id="question-text"></div>
                <div class="question-options" id="question-options"></div>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
